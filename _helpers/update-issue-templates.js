const fs = require('fs').promises;
const path = require('path');

const OUTPUT_PATH = path.resolve(
  __dirname,
  '..',
  '.github',
  'ISSUE_TEMPLATE',
  'template_bug_report.yml'
);
const INPUT_PATH = path.resolve(__dirname, 'template_bug_report.yml');
const TEMPLATES_FILE = path.resolve(__dirname, '..', 'templates.json');

async function getTemplateNames() {
  const templatesContent = JSON.parse(
    await fs.readFile(TEMPLATES_FILE, 'utf8')
  );
  return templatesContent.templates.map((t) => t.name);
}

async function run() {
  const templates = await getTemplateNames();

  const optionsList = templates
    .map((name) => {
      return `      - "${name}"`;
    })
    .join('\n');

  const inputFile = await fs.readFile(INPUT_PATH, 'utf8');
  const outputData = `# THIS FILE IS AUTOGENERATED. Please modify the source in _helpers\n${inputFile.replace(
    '# <<TEMPLATE_OPTIONS>>',
    optionsList
  )}`;

  await fs.writeFile(OUTPUT_PATH, outputData, 'utf8');
  console.log('Issue template updated');
}

run().catch(console.error);
